---
import { fetchArticoliWithSlugs, formatDate } from '../../lib/google-sheets';

let articoli: Awaited<ReturnType<typeof fetchArticoliWithSlugs>> = [];
try {
  articoli = await fetchArticoliWithSlugs();
  // Limit to 10 most recent
  articoli = articoli.slice(0, 10);
} catch (error) {
  console.error('Failed to fetch articles:', error);
}
---

<section id="blog" class="py-20 bg-secondary/30">
  <div class="container mx-auto px-4">
    <!-- Section Header -->
    <div class="text-center mb-12">
      <span class="inline-block px-4 py-2 bg-primary/10 text-primary text-sm font-bold rounded-full mb-4">
        Blog
      </span>
      <h2 class="text-4xl md:text-5xl font-serif font-bold text-text mb-4">
        Articoli e <span class="text-primary">Approfondimenti</span>
      </h2>
      <p class="text-lg text-text/70 max-w-2xl mx-auto">
        Consigli pratici e riflessioni sul benessere psicologico
      </p>
    </div>

    {articoli.length === 0 ? (
      <p class="text-center text-text/60">Nessun articolo disponibile al momento.</p>
    ) : (
      <div class="blog-swiper relative">
        <div class="swiper-wrapper">
          {articoli.map((articolo) => (
            <div class="swiper-slide">
              <a href={`/articolo/${articolo.slug}`} class="block h-full">
                <article
                  class="blog-card bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 h-full flex flex-col"
                >
                  {articolo.immagine && (
                    <div class="relative h-56 overflow-hidden">
                      <img
                        src={articolo.immagine}
                        alt={articolo.titolo}
                        class="w-full h-full object-cover hover:scale-110 transition-transform duration-500"
                      />
                    </div>
                  )}
                  <div class="p-6 flex-1 flex flex-col">
                    <time class="text-sm text-accent mb-2">
                      {formatDate(articolo.data)}
                    </time>
                    <h3 class="text-2xl font-serif font-bold text-primary mb-2">
                      {articolo.titolo}
                    </h3>
                    <p class="text-sm text-text/70 mb-3">
                      {articolo.sottotitolo}
                    </p>
                    <p class="text-text/80 leading-relaxed flex-1 line-clamp-3">
                      {articolo.descrizione}
                    </p>
                    <span class="mt-4 text-primary font-bold hover:text-accent transition-colors inline-flex items-center gap-2">
                      Leggi di pi√π
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3" />
                      </svg>
                    </span>
                  </div>
                </article>
              </a>
            </div>
          ))}
        </div>

        <!-- Navigation -->
        <div class="swiper-button-prev blog-prev"></div>
        <div class="swiper-button-next blog-next"></div>

        <!-- Pagination -->
        <div class="swiper-pagination blog-pagination"></div>
      </div>
    )}
  </div>
</section>

<script>
  import Swiper from 'swiper';
  import { Navigation, Pagination } from 'swiper/modules';
  import 'swiper/css';
  import 'swiper/css/navigation';
  import 'swiper/css/pagination';

  document.addEventListener('DOMContentLoaded', () => {
    new Swiper('.blog-swiper', {
      modules: [Navigation, Pagination],
      slidesPerView: 1,
      spaceBetween: 30,
      navigation: {
        nextEl: '.blog-next',
        prevEl: '.blog-prev',
      },
      pagination: {
        el: '.blog-pagination',
        clickable: true,
      },
      breakpoints: {
        640: {
          slidesPerView: 2,
        },
        1024: {
          slidesPerView: 3,
        },
      },
    });
  });
</script>

<style>
  .blog-swiper {
    padding-bottom: 4rem;
  }

  .swiper-button-prev,
  .swiper-button-next {
    color: var(--primary);
    background: white;
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: all 0.3s;
  }

  .swiper-button-prev:hover,
  .swiper-button-next:hover {
    background: var(--primary);
    color: white;
    transform: scale(1.1);
  }

  .swiper-button-prev::after,
  .swiper-button-next::after {
    font-size: 1.25rem;
  }

  .blog-card:hover {
    transform: translateY(-0.5rem);
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
