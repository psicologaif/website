---
import "../styles/global.css";
import NavbarDesktop from "../components/layout/NavbarDesktop.astro";
import NavbarMobile from "../components/layout/NavbarMobile.astro";
import Footer from "../components/layout/Footer.astro";
import CookieBanner from "../components/ui/CookieBanner.astro";
import StructuredData from "../components/seo/StructuredData.astro";
import AnalyticsInit from "../components/analytics/AnalyticsInit.astro";
import { generateLocalBusinessSchema, generatePersonSchema } from "../lib/seo";

interface Props {
  title: string;
  description?: string;
  image?: string;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
    tags?: string[];
  };
}

const {
  title,
  description = "Psicologa Ioana Frale - Psicoterapia Cognitivo Comportamentale a Teramo. Supporto per ansia, depressione e crescita personale.",
  image = "/images/og-default.jpg", // Todo: Add default OG image
  article,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const ogImage = new URL(image, Astro.site);

// Generate structured data for homepage
const isHomepage = Astro.url.pathname === "/";
const schemas: string[] = [];

if (isHomepage) {
  // LocalBusiness schema
  schemas.push(
    generateLocalBusinessSchema({
      name: "Dott.ssa Ioana Frale - Psicologa Psicoterapeuta",
      description: description,
      url: Astro.site?.toString() || "",
      telephone: "+39 328 673 9086",
      email: "psicologafrale@gmail.com",
      address: {
        streetAddress: "Via Roma, 176/A",
        addressLocality: "Silvi",
        addressRegion: "Abruzzo",
        postalCode: "64028",
        addressCountry: "IT",
      },
      priceRange: "€€",
      image: ogImage.toString(),
      openingHours: ["Mo-Fr 09:00-19:00"],
    }),
  );

  // Person schema
  schemas.push(
    generatePersonSchema({
      name: "Ioana Frale",
      givenName: "Ioana",
      familyName: "Frale",
      jobTitle: "Psicologa Psicoterapeuta",
      description:
        "Specializzata in Psicoterapia Cognitivo Comportamentale per adolescenti e adulti",
      url: Astro.site?.toString() || "",
      image: ogImage.toString(),
      email: "psicologafrale@gmail.com",
      telephone: "+39 328 673 9086",
      sameAs: [
        "https://www.facebook.com/ioanafrale",
        "https://www.instagram.com/ioanafrale",
        "https://www.linkedin.com/in/ioanafrale",
      ],
    }),
  );
}
---

<!doctype html>
<html lang="it" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <!-- SEO -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="psicologa teramo, psicoterapeuta teramo, terapia cognitivo comportamentale, supporto psicologico, consulenza psicologica, ansia, depressione, stress, benessere mentale, servizi psicologici Abruzzo, psicologa silvi, psicoterapeuta silvi, psicologa montorio al vomano, psicoterapeuta montorio al vomano"
    />
    <link rel="canonical" href={canonicalURL} />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="it" />
    <meta name="author" content="Dott.ssa Ioana Frale" />

    <!-- Geo Tags per SEO Locale -->
    <meta name="geo.region" content="IT-TE" />
    <meta name="geo.placename" content="Silvi, Teramo" />
    <meta name="geo.position" content="42.5458;14.1150" />
    <meta name="ICBM" content="42.5458, 14.1150" />

    <!-- Google Site Verification (uncomment when ready) -->
    <!-- <meta name="google-site-verification" content="YOUR_VERIFICATION_CODE" /> -->

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={article ? "article" : "website"} />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:locale" content="it_IT" />
    <meta property="og:site_name" content="Psicologa Ioana Frale" />

    {
      article && (
        <>
          <meta
            property="article:published_time"
            content={article.publishedTime}
          />
          {article.modifiedTime && (
            <meta
              property="article:modified_time"
              content={article.modifiedTime}
            />
          )}
          {article.author && (
            <meta property="article:author" content={article.author} />
          )}
          {article.tags?.map((tag) => (
            <meta property="article:tag" content={tag} />
          ))}
        </>
      )
    }

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImage} />

    <!-- Structured Data JSON-LD -->
    {schemas.length > 0 && <StructuredData schemas={schemas} />}

    <!-- Additional head content from child layouts -->
    <slot name="head" />
  </head>
  <body
    class="bg-secondary text-text antialiased flex flex-col min-h-screen pb-20 lg:pb-0"
  >
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-white px-4 py-2 rounded z-50"
    >
      Vai al contenuto principale
    </a>

    <NavbarDesktop />
    <NavbarMobile />

    <main id="main-content" class="flex-grow">
      <slot />
    </main>

    <Footer />
    <CookieBanner />
    <AnalyticsInit />
  </body>
</html>
